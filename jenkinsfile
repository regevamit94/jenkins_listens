pipeline {
    agent any
    
    environment {
    /*    CLUSTERNAME = 'test'*/
    }

    stages {
        stage('Check if Cluster exists') {
            steps {
                script {
                    def statusCode = sh(script: "kind get clusters | grep -w test1", returnStatus: true).trim()
                    if (statusCode == '0') {
                        error "Kubernetes cluster '$CLUSTERNAME' is not running!"
                        sh(script:"kind create cluster --name $CLUSTERNAME --image kindest/node:v1.23.6 --config ~/imjenkinsslave/kind.yaml")
                    } else {
                        echo "Kubernetes cluster '$CLUSTERNAME' is running."
                    }
                }
            }
        }
    }
}
